<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SAPVS — Syntax-Aware Protocol Verification System</title>
<style>
  :root{
    --bg:#0b1220;--card:#111827;--border:#1f2937;--text:#e2e8f0;--muted:#94a3b8;--acc:#3b82f6;
    --mono: ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    --sans: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:var(--sans)}
  .container{max-width:980px;margin:0 auto;padding:24px}
  .nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border)}
  .nav a{color:var(--text);text-decoration:none;margin-left:18px;opacity:.9}
  .nav a:hover{opacity:1}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;margin:18px 0}
  h1{margin:.2rem 0 1rem}
  .badges span{display:inline-block;background:#0b1220;border:1px solid var(--border);padding:6px 10px;border-radius:999px;margin:2px;font-size:.85rem}
  .code{font-family:var(--mono);background:#0b1220;border:1px dashed var(--border);border-radius:10px;padding:10px;overflow:auto}
  .btn{display:inline-block;background:var(--acc);color:white;padding:8px 12px;border-radius:10px;text-decoration:none;border:0;cursor:pointer}
  .btn:hover{filter:brightness(1.05)}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  textarea{width:100%;min-height:160px;background:#0b1220;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px;font-family:var(--mono)}
  .result{padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b1220}
  .pass{border-color:#14532d;color:#bbf7d0}
  .fail{border-color:#7f1d1d;color:#fecaca}
  .debug{font-family:var(--mono);font-size:.9rem;color:#cbd5e1;background:#0b1220;border:1px solid var(--border);border-radius:10px;padding:10px;white-space:pre-wrap}
  .ok{background:#052e16;border:1px solid #14532d;color:#bbf7d0;padding:6px 10px;border-radius:8px;font-family:var(--mono);display:inline-block}
  footer{margin-top:30px;color:var(--muted);font-size:.9rem;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
</style>
<noscript>
  <div style="background:#7f1d1d;color:#fecaca;padding:12px;text-align:center;">
    JavaScript is disabled — enable it to use the Rule Playground.
  </div>
</noscript>
</head>
<body>
  <div class="container">
    <div class="nav">
      <div><strong>SAPVS</strong></div>
      <div><a href="./">Home</a></div>
    </div>

    <section class="card">
      <div id="scriptFlag" class="ok" style="display:none">Script loaded ✅</div>
      <h1>Syntax-Aware Protocol Verification System</h1>
      <p>Automated, grammar- and state-aware verifier for network protocols — built for correctness and security analysis.</p>
      <div class="badges"><span>ABNF/PEG</span><span>Rule DSL</span><span>State Engine</span><span>JSON Reports</span></div>
    </section>

    <section class="card">
      <h2>Rule Playground (browser demo)</h2>
      <p>Paste a raw HTTP/1.1 request or response. Click Run Checks.</p>
      <div class="grid">
        <div>
          <button class="btn" onclick="SAPVS_fill('ok')">Paste Example (Valid)</button>
          <button class="btn" style="background:#ef4444" onclick="SAPVS_fill('badHost')">Missing Host (Fail)</button>
          <button class="btn" style="background:#f59e0b" onclick="SAPVS_fill('noStart')">No Start-Line (Fail)</button>
        </div>
        <textarea id="httpInput" placeholder="Paste HTTP here..."></textarea>
        <div id="httpOut" class="result">No input yet.</div>
        <div><button class="btn" onclick="SAPVS_run()">Run Checks</button></div>
        <div class="debug" id="debugBox">Debug: (will populate after Run Checks)</div>
      </div>
    </section>

    <footer>
      <span>© 2025 SAPVS — Developed by Jenin, Raswanth & Yogesh. MIT License.</span>
      <span><a href="#" style="color:#93c5fd">GitHub</a></span>
    </footer>
  </div>

<script>
/* ===== ultra-compatible JS (no modern syntax) ===== */
(function(){
  function $(id){ return document.getElementById(id); }
  function norm(s){
    if(!s){ return ""; }
    // strip BOM, normalize newlines, trim leading whitespace
    return String(s).replace(/\uFEFF/g,"").replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/^\s+/, "");
  }

  function runChecks(){
    var input = $("httpInput");
    var out   = $("httpOut");
    var dbg   = $("debugBox");
    if(!input || !out || !dbg){ return; }

    var text = norm(input.value);
    var findings = [];

    // Allow leading whitespace before start-line
    var reqRe  = /^\s*(GET|POST|PUT|DELETE|HEAD|OPTIONS|PATCH)\s+\S+\s+HTTP\/1\.[01]\b/i;
    var respRe = /^\s*HTTP\/1\.[01]\s+(\d{3})\b/i;

    var isRequest = reqRe.test(text);
    var respMatch = text.match(respRe);
    var isResponse = !!respMatch;
    var statusCode = isResponse ? parseInt(respMatch[1], 10) : null;

    // Request rules
    if (isRequest) {
      // Prepend newline so the regex matches even if Host is first header
      if (!(/\nHost:\s*[^\n]+/i).test("\n" + text)) {
        findings.push("HTTP/1.1 request MUST include Host header");
      }
    }

    // Response rules
    if (isResponse) {
      if (!(statusCode >= 100 && statusCode <= 599)) {
        findings.push("HTTP response status code must be 100..599");
      }
    }

    // Invalid/incomplete message
    if (text.length > 0 && !isRequest && !isResponse) {
      findings.push("Invalid HTTP/1.1 message: missing start-line (e.g., 'GET /… HTTP/1.1' or 'HTTP/1.1 200 OK').");
    }

    // Render result
    if (text.replace(/\s+/g,"").length === 0) {
      out.className = "result";
      out.textContent = "No input yet.";
    } else if (findings.length === 0) {
      out.className = "result pass";
      out.textContent = "No findings. Looks good ✔";
    } else {
      // Build simple bullet list
      var html = "<b>Findings:</b><ul>";
      for (var i=0;i<findings.length;i++){ html += "<li>"+findings[i]+"</li>"; }
      html += "</ul>";
      out.className = "result fail";
      out.innerHTML = html;
    }

    // Debug panel
    var firstLine = (text.split("\n")[0] || "(empty)");
    dbg.textContent = "Detected:\n"
      + "  isRequest  = " + isRequest + "\n"
      + "  isResponse = " + isResponse + "\n"
      + "  statusCode = " + (statusCode === null ? "n/a" : statusCode) + "\n"
      + "Text length: " + text.length + "\n"
      + "Preview (first line): " + firstLine;
  }

  function fill(kind){
    var ok =
"GET /index.html HTTP/1.1\n\
Host: example.com\n\
User-Agent: SAPVS\n\
\n";
    var missingHost =
"GET /index.html HTTP/1.1\n\
User-Agent: SAPVS\n\
\n";
    var noStartLine =
"Date: Thu, 06 Nov 2025 10:00:00 GMT\n\
Server: SAPVS-Demo\n\
Content-Type: text/html\n\
Content-Length: 123\n";

    var v = ok;
    if (kind === "badHost") v = missingHost;
    if (kind === "noStart") v = noStartLine;

    $("httpInput").value = v;
    runChecks();
  }

  // Expose globals for inline onclick
  window.SAPVS_run  = runChecks;
  window.SAPVS_fill = fill;

  // Mark “script loaded” and prefill valid example immediately
  try {
    $("scriptFlag").style.display = "inline-block";
  } catch(e){}
  fill("ok");
})();
</script>
</body>
</html>
